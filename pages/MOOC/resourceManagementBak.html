<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="description" content="Xenon Boostrap Admin Panel" />
	<meta name="author" content="" />
    <link href="/styleFromTemplate/css/bootstrap.min.css" rel='stylesheet' type='text/css' />
    <!-- Custom CSS -->
    <link href="/styleFromTemplate/css/style.css" rel='stylesheet' type='text/css' />
    <!--link href="/styleFromTemplate/css/font-awesome.css" rel="stylesheet"-->
    <!--link rel="stylesheet" href="/styleFromTemplate/css/icon-font.min.css" type='text/css' /-->

    <link href="/styleFromTemplate/css/animate.css" rel="stylesheet" type="text/css" media="all">

    <script src="/styleFromTemplate/js/wow.min.js"></script>
    <script src="/styleFromTemplate/js/jquery-1.10.2.min.js"></script>

    <script type="text/javascript" src="/scripts/StationJSLib.js"></script>
    <script type="text/javascript" src="/scripts/StationJSLib-bak.js"></script>

    <link rel="stylesheet" href="/scripts/htmleditor/themes/default/default.css" />
    <link rel="stylesheet" type="text/css" href="/CSS/maintain/alert.css" />

    <script type="text/javascript" src="/scripts/jquery.alert.js"></script>
    <script type="text/javascript" src="/scripts/jquery-migrate-1.2.1.js"></script>
    <script type="text/javascript" src="/scripts/jquery-ui.min.js"></script>

    <script type="text/javascript" src="/scripts/htmleditor/kindeditor.js"></script>
    <script type="text/javascript" src="/scripts/htmleditor/lang/zh_CN.js"></script>
    <!--下面是为了实现标题的颜色选择器添加的插件 -->
    <link rel="stylesheet" type="text/css" href="/CSS/iColor.css" />
    <script type="text/javascript" src="/scripts/iColor-min.js"></script>
    <script>
      function fileSpaceManagement(){
	  $("#mainContent").html("");
	  var paras = "pageNumber=1";
	  paras += "$^@^$pageSize=9";
	  paras += "$^@^$infoType=";
	  //loadFromWS("adminUsers/fileSpaceManagement.template",paras,"mainContent");
	  loadFromWS("zyMooc/zyFileSpaceManagementBak.template",paras,"mainContent");
        }
    
	</script>
<script>

    function checkImg(filename){

        var index = filename.lastIndexOf("."); //得到"."在第几位
        var fileType = filename.substring(index); //截断"."之前的，得到后缀
        if(fileType==".bmp"||fileType==".png"||fileType==".gif"||fileType==".jpg"||fileType==".jpeg"){  //根据后缀，判断是否符合图片格式
            return true;
        }
        return false;
    }
    function checkPdf(filename){
        var index = filename.lastIndexOf("."); //得到"."在第几位
        var fileType = filename.substring(index); //截断"."之前的，得到后缀
        if(fileType==".pdf"){  //根据后缀，判断是否符合图片格式
            return true;
        }
        return false;
    }
    function checkPpt(filename){
        var index = filename.lastIndexOf("."); //得到"."在第几位
        var fileType = filename.substring(index); //截断"."之前的，得到后缀
        if(fileType==".pptx"||fileType==".ppt"){  //根据后缀，判断是否符合图片格式
            return true;
        }
        return false;
    }
    function checkWord(filename){
        var index = filename.lastIndexOf("."); //得到"."在第几位
        var fileType = filename.substring(index); //截断"."之前的，得到后缀
        if(fileType==".txt"||fileType==".doc"||fileType==".docx"||fileType==".rtf"||fileType=="wps"){  //根据后缀，判断是否符合图片格式
            return true;
        }
        alert(hemm);
        return false;
    }
    function checkTv(filename){
        var index = filename.lastIndexOf("."); //得到"."在第几位
        var fileType = filename.substring(index); //截断"."之前的，得到后缀
        if(fileType==".mp4"||fileType==".avi"||fileType==".war"||fileType==".mov"||fileType==".flv"||fileType==".asf"||fileType==".rmvb"){ //根据后缀，判断是否符合视频格式
            return true;
        }
        return false;
    }
</script>

	<script>
		//防止未登录直接输入网址访问该网页
	    var userId = localStorage.getItem('userId');
        var userToken = localStorage.getItem('userToken');
        var classification = localStorage.getItem('classification');
        var loginName = localStorage.getItem('loginName');
        if(!userId || !userToken || !classification || !loginName ){

            location.href="login.html";
       		}


	</script>
	<title>mooc后台管理</title>

	<link rel="stylesheet" href="assets/css/fonts/linecons/css/linecons.css">
	<link rel="stylesheet" href="assets/css/fonts/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="assets/css/bootstrap.css">
	<link rel="stylesheet" href="assets/css/xenon-core.css">
	<link rel="stylesheet" href="assets/css/xenon-forms.css">
	<link rel="stylesheet" href="assets/css/xenon-components.css">
	<link rel="stylesheet" href="assets/css/xenon-skins.css">
	<link rel="stylesheet" href="assets/css/main.css">


	<script src="assets/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="/scripts/StationJSLib.js"></script>

	<script>

	var userId = localStorage.getItem('userId');
        var userToken = localStorage.getItem('userToken');
        var classification = localStorage.getItem('classification');
        var loginName = localStorage.getItem('loginName');
        if(!userId || !userToken || !classification || !loginName){

            location.href="login.html";
   		}

	</script>


</head>
<style>
.showInfo{
  border:none;
  outline: none;
}
.editbutton{
    background-color: #68b828;
    color: #ffffff;
    outline: none;
}
</style>
<body class="page-body">
<script>

	//保持(被选中的)侧边栏高亮
    function keepActive(){
        $("#a_resourceManagement").parent().addClass('active');
    }
	jQuery(document).ready(function($) {
		$(".user-info-menu #loginName").html(localStorage.getItem("loginName"));
		var userInfoArray = new Array();	
		var userInfoResult = function(){//admin,汤汤,123456789,武汉大学,super
			var id = userInfoArray[0].split(',')[0];
			var loginName = userInfoArray[0].split(',')[1];
			var name = userInfoArray[0].split(',')[2];
			var phone_number = userInfoArray[0].split(',')[3];
			var address = userInfoArray[0].split(',')[4];
			var roleName = userInfoArray[0].split(',')[5];
			$("#userName").text(name+" , 您好，欢迎进入MOOC系统后台管理");
			$("#IDS").text(id);  
			$("#trueNameS").text(name);
			$("#loginNameS").text(loginName);
			$("#roleS").text(roleName);
			$("#telephoneS").text(phone_number);
			$("#addressS").text(address); 
			//$("#IDS").val(id);
			//$("#trueNameS").val(name);
			//$("#loginNameS").val(loginName);
			//$("#roleS").val(roleName);
			//$("#telephoneS").val(phone_number);
			//$("#addressS").val(address);
			var html = new Array();
			var htmlResult = function(){
				$("#main-menu").append(html[0]);
				keepActive();
			};
			getFromWS("mainmooc/getNav.template","classification="+classification, html, htmlResult);
			 fileSpaceManagement()

		};
		
		var login_name=loginName;
		getFromWS("mainmooc/getUserInfo.template", "operation=getUserInfo$^@^$loginNname="+login_name, userInfoArray, userInfoResult);

        function viewFileB(fileId,fileName){
			alert("in viewFile");
            if(checkImg(fileName)){
                var html = '<center><img width="550" height="400" src="/one/downloadFile.spe?dtype=PostgresXL&mode=html&fileid='+fileId+'"></center>';
                $("#viewbox").html(html);
                hiBox('#viewbox',fileName,650,500,'');
            }else if(checkTv(fileName)){
                var html = '<center><video src="/one/downloadFile.spe?dtype=PostgresXL&mode=html&fileid='+fileId+'"  controls="true" width="550" height="400" autoplay="autoplay"/></center>';
                $("#viewbox").html(html);
                hiBox('#viewbox',fileName,650,500,'');
            }else if(checkWord(fileName)){
                alert('hello');
                var request=null;
                if(window.XMLHttpRequest){request=new XMLHttpRequest();}else if(window.ActiveXObject){request=new ActiveXObject("Microsoft.XMLHTTP");}
                if(request){
                    request.open("GET","/one/downloadFile.spe?dtype=PostgresXL&mode=html&fileid=fileId",true);
                    request.overrideMimeType("text/html;charset=gb2312");//设定以gb2312编码识别数据
                    request.onreadystatechange=function(){
                        if(request.readyState===4){
                            if (request.status == 200 || request.status == 0){
                                //var reader = new FileReader();
                                alert(request.responseText);
                                $("#viewbox").html(request.responseText);
                                hiBox('#viewbox',fileName,650,500,'');
                            }
                        }
                    }
                    request.send(null);
                }else{
                    alert("error");
                }
            }else if(checkPdf(fileName)){
                var html = '<center><object data="/one/downloadFile.spe?dtype=PostgresXL&mode=html&fileid='+fileId+'" width="550" height="400"/></center>';
                $("#viewbox").html(html);
                hiBox('#viewbox',fileName,650,500,'');

            }else if(checkPpt(fileName)){
                var html = '<center><object data="/one/downloadFile.spe?dtype=PostgresXL&mode=html&fileid='+fileId+'" width="550" height="400"/></center>';
                $("#viewbox").html(html);
                hiBox('#viewbox',fileName,650,500,'');
            }
            else{
                alert("格式不支持预览");
            }

        }
	});
</script>
	<div class="page-container">
		<div class="sidebar-menu toggle-others fixed">
			<div class="sidebar-menu-inner">
				<header class="logo-env">
					<div class="logo">
						<a href="#" class="logo-expanded">
							<img src="assets/images/logo@2x.png" width="80" alt="" />
						</a>
						<a href="#" class="logo-collapsed">
							<img src="assets/images/logo-collapsed@2x.png" width="40" alt="" />
						</a>
					</div>

					<div class="mobile-menu-toggle visible-xs">
						<a href="#" data-toggle="user-info-menu">
							<i class="fa-bell-o"></i>
							<span class="badge badge-success">7</span>
						</a>

						<a href="#" data-toggle="mobile-menu">
							<i class="fa-bars"></i>
						</a>
					</div>
				</header>

				<ul id="main-menu" class="main-menu">

				</ul>

			</div>

		</div>

		<div class="main-content">


			<nav class="navbar user-info-navbar" role="navigation">
				<ul class="user-info-menu left-links list-inline list-unstyled">
		            <li class="hidden-sm hidden-xs">
		                <a href="#" data-toggle="sidebar">
		                    <i class="fa-bars"></i>
		                </a>
		            </li>
	            </ul>
				<ul class="user-info-menu left-links list-inline list-unstyled">
					<a href="#" data-toggle="sidebar" title="武汉大学出版社">
						<img src="images/logo.png" width="170" alt="武汉大学出版社" />
					</a>
				</ul>

				<ul class="user-info-menu right-links list-inline list-unstyled">

					<li class="dropdown user-profile">
						<a href="#" data-toggle="dropdown">
							<img src="assets/images/user-4.png" alt="user-image" class="img-circle img-inline userpic-32" width="28" />
							<span id="loginName"></span>
						</a>
					</li>

					<li>
						<a href="javaScript:logout()">
							<i class="fa-power-off"  style="color:red;font-size:18px;"></i>
						</a>
					</li>

				</ul>

			</nav>

			<div class="page-title">
				<div class="title-env">
					<h1 class="title">资源管理</h1>
					<!--<p class="description">management of resource</p>--></div>
				<div class="breadcrumb-env">
					<ol class="breadcrumb bc-1">
						<li>
							<a href="articleManagement.html">
								<i class="fa-home"></i>首页</a>
						</li>
						<li class="active">
							<strong>资源管理</strong></li>
					</ol>
				</div>
			</div>



<script type="text/javascript">
function digmodal(number) {
    var idd=$("#IDS").html();//alert(""+idd);

	if(1==number){
    	$('#editmodalPhone').modal('show');
		var phone=$("#telephoneS").html();//alert(""+phone);取电话的值
		$('#newPhone').val(phone);

		$('#editsavePhone').on('click', function () {
			//alert(nid);
			var newPhone = $("#newPhone").val();
			if (!newPhone) {
			    alert("输入不能为空！");
			    return;
			}
		 var obj_update = new Array();
			var processResult_update = function () {
			    if("ok"!=obj_update[0]){
			    	alert(obj_update[0]);
			    }
			    location.reload(true);
			}
			getFromWS("mianmooc/saveUserInfo.template", "operation=editPhone$^@^$id=" + idd + "$^@^$phone=" + newPhone, obj_update, processResult_update);
			$('#editmodalPhone').modal('hide');
		})
		}
	else if(number==2){
    	$('#editmodalEmail').modal('show');
		var addr=$("#addressS").html();//alert(""+addr);
		$('#newEmail').val(addr);

		$('#editsaveEmail').on('click', function () {
			//alert(nid);
			var newEmail = $("#newEmail").val();//alert(newAddr);
			if (!newEmail) {
			    alert("输入不能为空！");
			    return;
			}
		 	var obj_update = new Array();
			var processResult_update = function () {
			    if("ok"!=obj_update[0]){
			    	alert(obj_update[0]);
			    }
			    location.reload(true);
			}
			getFromWS("mianmooc/saveUserInfo.template", "operation=editAddr$^@^$id=" + idd + "$^@^$email=" + newEmail, obj_update, processResult_update);
			$('#editmodalEmail').modal('hide');
		})

	}

}

function digpasswd(){
    var idd=$("#IDS").html();
    $('#editpasswd').modal('show');
    var flag=true;
    $('#editpwdsave').on('click', function () {
	var loginname=$("#loginNameS").html();
	var oldp=$("#oldpwd").val();
    	var newp=$("#newpwd").val();
        var newp2=$("#newpwd2").val();
	var error="";
	if (!oldp || !newp || !newp2) {
		flag=false;
		error=error+"输入的密码不能为空！\n";
	}
	if(newp!=newp2){
		flag=false;
		error=error+"两次输入的新密码不一致\n";
	}
	if(false==flag)
	{
		alert(error);
		return;
	}
      var obj_update = new Array();
      var processResult_update = function () {
	if("ok"!=obj_update[0]){
		alert("执行结果：\n"+obj_update[0]);
	}else{
		alert("修改成功，请重新登录");
		logout()
	}
    }
	getFromWS("mianmooc/saveUserInfo.template", "operation=editPwd$^@^$id=" + idd + "$^@^$login=" + loginname + "$^@^$old=" + oldp+ "$^@^$new=" + newp, obj_update, processResult_update);
	$('#editpasswd').modal('hide');

   })

}

</script>

            <div class="graphs" id="mainContent">

            </div>
			<footer class="main-footer sticky footer-type-1">
				<div class="footer-inner">
					<div class="footer-text">&copy; 2017
						<strong>MOOC服务</strong>
						<a href="#" target="_blank">MOOC管理系统</a>- Collect from
						<a href="#" title="国家网络安全学院" target="_blank">国家网络安全学院</a></div>
					<div class="go-up">
						<a href="#" rel="go-top">
							<i class="fa-angle-up"></i>
						</a>
					</div>
				</div>
			</footer>
        </div>



		</div>
	</div>

	<div class="page-loading-overlay">
		<div class="loader-2"></div>
	</div>

	<!-- Bottom Scripts -->
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/js/TweenMax.min.js"></script>
	<script src="assets/js/resizeable.js"></script>
	<script src="assets/js/joinable.js"></script>
	<script src="assets/js/xenon-api.js"></script>
	<script src="assets/js/xenon-toggles.js"></script>

	<!-- Imported scripts on this page -->
	<script src="assets/js/xenon-widgets.js"></script>
	<script src="assets/js/devexpress-web-14.1/js/globalize.min.js"></script>
	<script src="assets/js/devexpress-web-14.1/js/dx.chartjs.js"></script>
	<script src="assets/js/toastr/toastr.min.js"></script>

	<!-- JavaScripts initializations and stuff -->
	<script src="assets/js/xenon-custom.js"></script>
</body>

</html>
